<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>homepage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <!-- ----------------------------------------font- awesome of montserrat-------------------------------- -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
        
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@latest/font/bootstrap-icons.css" rel="stylesheet">
        




        <!-- this is for alertify -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs/build/css/alertify.min.css"/>
        <!-- Default theme for Alertify -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs/build/css/themes/default.min.css"/>
        <script src="https://cdn.jsdelivr.net/npm/alertifyjs/build/alertify.min.js"></script>


         <!--------------------------jquery ---------------------------->
         <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="../css_folder/home.css">
    <script src="../js_folder/create_and_join.js"></script>
    <script src="../js_folder/post.js"></script>
    <script src="../js_folder/profile.js"></script>
</head>
<body>
    <div class="container">
        <div class="row navbar">
            <div class="col-6 d-flex align-items-center">
                <img src="../image/bar.png" width="50px" height="50px" style="background-color: white;" class="rounded-circle" alt="" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
            </div>
            <div class="col-6 d-flex justify-content-end align-items-center">
                <img src="../image/profile_image.jpg" alt="" class="rounded-circle shadow"  width="50px" height="50px" id="profile-2">
            </div>
        </div>

        <div class="row" id="creation">
            <div class="col d-flex justify-content-end">
                <div class="row px-5" id="create-join">
                    <div class="col" style="position: relative;">
                        <img src="../image/plus.png" alt="" class="mt-2 shadow rounded-circle" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample" aria-expanded="false" aria-controls="collapseWidthExample" width="45px" height="45px">
                        <div>
                            <div class="collapse collapse-horizontal" id="collapseWidthExample">
                                <table class="table table-striped" style="position: absolute;">
                                    <tr>
                                        <td style="padding: 1px 30px;" data-bs-toggle="modal" data-bs-target="#target4">join</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 1px 30px;"  data-bs-toggle="modal" data-bs-target="#target3">create</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>        
    </div>
    
    <div class="container w-75">
        <div class="row" id="contain-1">
                    <div class="row d-flex" id="con"></div>
                    
            </div>
        </div>
    </div>
   <!-------------------this is for off canvas-------------------->
    <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
        <div class="offcanvas-header">
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" onclick="close2()" id="close11"></button>
        </div>
        <div class="offcanvas-body">
            <button class="bt" id="bt-1" onclick="visible('contain-2','contain-3','contain-1')">home</button>
            <button class="bt" onclick="visible('contain-2','contain-1','contain-3')">profile</button>
            <button class="bt" id="logout">logout</button>
        </div>
      </div>




      <div class="container px-3 my-5" id="contain-2">
        <div class="row">
            <div class="row-6 bk shadow justify-content-end d-flex">
                <h2 class="bk-name mx-3" id="class-name"></h2>
                <div class="ccode" style="
                width: 100%;
                height: 150px;
                padding-top: 100px;
                color: white;">
                    <h3>CODE : <span id="class-code"></span></h3>
                </div>
            </div>
            <div class="row-4">
                <button class="post" data-bs-toggle="modal" data-bs-target="#target5">post</button>
            </div>
            <div class="row-8 rounded-4 p-4" >
                <div class="row" id="postsContainer">
                    <!-- <div class="row">
                        <div class="col-2 col-md-1">
                            <img src="../image/image2.webp" alt="" width="50px" height="50px" class="rounded-circle">
                        </div>
                        <div class="col-2">
                            <h6>tamilarasu</h6>
                            <p>11.12.1212</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="row">
                            <h3>title</h3>
                        </div>
                        <div class="row-6 shadow d-flex">
                            <p>tamil arasu is a good boy</p>
                            <img src="../image/download.webp" alt="" width="30px" height="30px" class="mx-2" data-bs-toggle="tooltip" title="Download">
        
                        </div>
                    </div>
                    <div class="row my-4">
                        <div class="col-1">
                            <img src="../image/image2.webp" width="50px" height="50px" class="rounded-circle" alt="">
                        </div>
                        <div class="col">
                            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Harum quaerat in, aperiam rerum ducimus, voluptas, quasi minus obcaecati eius modi error. Perferendis qui officia reprehenderit aperiam libero adipisci numquam iste.</p>
                        </div>
                    </div>
                    <div class="row-12 d-flex mt-5">
                        <div class="col-3 col-md-1">
                            <img src="../image/image2.webp" width="50px" height="50px" class="rounded-circle" alt="">
                        </div>
                        <form action="" id="comment_post">
                            <div class="col-8">
                                <input type="text" class="rounded-4 p-2" style="width: 100%;" id="comment" placeholder="Enter your comment">
                            </div>
                            <div class="col px-3 py-1">
                                <img src="../image/send.png" alt="" type="submit" width="20px" height="20px">
                            </div>
                        </form>
                    </div> -->
                </div>
            </div>
        </div>
      </div>




      <!----------------------this is for profile-->
      <div class="container mt-4  vh-100" id="contain-3">
        <div class="row">
            <div class="col col-lg-5">
                <div class="text-center bg-body-secondary rounded-5 mb-5">
                    <div class="d-flex justify-content-center pt-4">
                        <section style="position: relative;" class="d-flex justify-content-center">
                            <form action="" id="image_upload" enctype="multipart/form-data">
                                <label for="profile-image-upload" style="position: relative;">
                                    <img src="../image/profile_image.jpg" id="profile-1" class="rounded-circle img-fluid position-relative" alt="" style="width: 300px; height: 300px;">
                                    <div class="con">
                                        <img src="../image/plus.png" class="position-absolute rounded-circle" alt="" style="width: 55px; height: 55px; bottom: 0.5px; right: 70px; background-color: white; cursor: pointer;">
                                    </div>
                                </label>
                                <h6 class="my-2 p-3" style="color:red">NOTE:<span style="color:black">select the image using + sign, then click the upload button</span></h6>

                                <input type="file" id="profile-image-upload" name="profileImage" style="display: none;" />
                                <button type="button" onclick="uploadImage()" style="background-color: #113A5D; color: whitesmoke;" class="rounded-2 p-2 mb-4">Upload Image</button>
                            </form>
                            
                            
                        </section>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="accordion accordion-flush mt-5" id="accordionFlushExample">
                    <div class="accordion-item mb-5">
                        <h2 class="accordion-header" id="flush-headingThree">
                            <button class="accordion-button collapsed bg-body-secondary rounded-4" id="cpassword-close" type="button"
                                data-bs-toggle="collapse" data-bs-target="#flush-collapseThree"
                                aria-expanded="false" aria-controls="flush-collapseThree">
                                Change Password
                            </button>
                        </h2>

                        <!---------------------password changing sections ---------------------------------->
                        <div id="flush-collapseThree" class="accordion-collapse collapse"
                            aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushExample">
                            <form id="changepassword">
                                <div class="row py-3 px-4">
                                    <div class="form-floating">
                                        <input type="password" class="form-control shadow-none" id="oldpassword"
                                            name="username" placeholder="oldpassword"
                                            style="background-color:#e0e0e0">
                                        <label for="floatingInput" class="ms-2"
                                            style="mix-blend-mode: multiply;">Old Password</label>
                                    </div>
                                </div>
                                <div class="row py-3 px-4">
                                    <div class="form-floating">
                                        <input type="password" class="form-control shadow-none" id="newpassword"
                                            name="username" placeholder="newpassword"
                                            style="background-color:#e0e0e0">
                                        <label for="floatingInput" class="ms-2"
                                            style="mix-blend-mode: multiply;">New Password</label>
                                    </div>
                                </div>
                                <div class="row py-3 px-4">
                                    <div class="form-floating">
                                        <input type="password" class="form-control shadow-none" id="cnewpassword"
                                            name="username" placeholder="newpassword"
                                            style="background-color:#e0e0e0">
                                        <label for="floatingInput" class="ms-2"
                                            style="mix-blend-mode: multiply;">Retype the Password</label>
                                    </div>
                                </div>
                                <div class="row btn-span px-5 py-3">
                                    <button class="btn shadow py-3 px-2 rounded-4"  type="submit" id="button"
                                    style="background-color: #164863; color: whitesmoke;">Change Password</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <!--this is for create a class--------------------->
    <div class="modal fade" id="target3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content" id="create_class_model">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Create Class</h1>
                    <button type="button" class="btn-close" id="close-model1" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="create_class" enctype="multipart/form-data">
                        <div class="row p-2">
                            <div class="form-floating">
                                <input type="text" class="form-control shadow-none" id="classname" name="classname"
                                    placeholder="name@example.com" style="background-color:#ECE6E6">
                                <label for="floatingInput" class="ms-2" style="mix-blend-mode: multiply;">Classname</label>
                            </div>
                        </div>
                        <div class="row p-2">
                            <div class="form-floating">
                                <input type="file" class="form-control shadow-none" id="classprofile" name="classprofile"
                                    placeholder="name@example.com" style="background-color:#ECE6E6">
                                    <label for="floatingInput" class="ms-2" style="mix-blend-mode: multiply;">class profile</label>
                            </div>
                        </div>
                        <div class="row btn-span px-5 py-2">
                            <button class="btn shadow py-3 mx-5 px-5 w-50" type="submit"  id="btn">create</button>
                        </div>  
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- #region     this is for join class-->
    <div class="modal fade" id="target4" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content" id="join_model">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Join Class</h1>
                    <button type="button" class="btn-close" id="close-model" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="join_class">
                        <div class="row p-2">
                            <div class="form-floating">
                                <input type="text" class="form-control shadow-none" id="join_code" name="join_code"
                                    placeholder="name@example.com" style="background-color:#ECE6E6">
                                <label for="floatingInput" class="ms-2" style="mix-blend-mode: multiply;">Class Code</label>
                            </div>
                        </div>
                        <div class="row btn-span px-5 py-2">
                            <button class="btn btn-primary shadow py-3 mx-5 px-5 w-50" type="submit" id="btn">join</button>
                        </div>  
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!------------------this is for post -->
    <div class="modal fade" id="target5" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content" id="post_content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">POST</h1>
                    <button type="button" class="btn-close" id="post-model" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="post_form" enctype="multipart/form-data">
                        <div class="row p-2">
                            <div class="form-floating">
                                <input type="text" class="form-control shadow-none" id="title" name="title" placeholder="Title" style="background-color:#ECE6E6">
                                <label for="title" class="ms-2" style="mix-blend-mode: multiply;">TITLE</label>
                            </div>
                        </div>
                        <div class="row p-2">
                            <div class="form-floating">
                                <input type="file" class="form-control shadow-none" id="sfile" name="sfile" style="background-color:#ECE6E6">
                                <label for="sfile" class="ms-2" style="mix-blend-mode: multiply;">File</label>
                            </div>
                        </div>
                        <div class="row btn-span px-5 py-2">
                            <button class="btn btn-primary shadow py-3 mx-5 px-5 w-50" type="submit" id="btn">POST</button>
                        </div>  
                    </form>
                    
                </div>
            </div>
        </div>
    </div>

    <script>
        var t=document.getElementById("contain-2");
        var s=document.getElementById("contain-3");
        t.style.display='none';
        s.style.display='none';
        function visible(a, b, c) {
    var t = document.getElementById(a);
    var s = document.getElementById(b);
    var r = document.getElementById(c);
    
    t.style.display = 'none';
    s.style.display = 'none';
    r.style.display = 'block';
    close2();
    // // Set the display property of 'join' based on the condition
    // var joinElement = document.getElementById('create-join');
    // joinElement.style.display = 'none';
    
}
function close2()
{
document.getElementById('close11').click();
}





function uploadImage() {
        console.log('uploadImage');
        var formData = new FormData();
        var fileInput = document.getElementById('profile-image-upload');
        formData.append('profileImage', fileInput.files[0]);
        formData.append('uploadImage', true);
        console.log('fileInput:', fileInput.files[0]);
        $.ajax({
            url: '../php_folder/profile.php',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                response = JSON.parse(response);
                if (response.status === 200) {
                    image();
    
                } else {
                    alertify.set('notifier', 'position', 'top-right');
                    alertify.error('Image upload failed');
                    
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX request failed:', status, error);
                console.log(xhr.responseText); // Log the full response for additional details
                alert('AJAX request failed. Please check the console for more information.');
            }
        });
    }



    function image() {
    $.ajax({
        url: '../php_folder/profile.php',
        type: 'POST',
        data: {
            'profile_retrieve': true
        },
        success: function(response) {
            response = JSON.parse(response);
            if (response.status === 200) {
                var profileImageSrc = response.data.profile ? '../userprofile/' + response.data.profile : '../image/profile_image.jpg';
                console.log('profileImageSrc:', profileImageSrc);
                // Set profile image src based on availability
                if (profileImageSrc) {
                    console.log('profileImageSrc:', profileImageSrc);
                    document.getElementById('profile-1').src = profileImageSrc;
                    document.getElementById('profile-2').src = profileImageSrc;
                } else {
                    // If profile image not available, set default image
                    document.getElementById('profile-2').src = '../image/profile_image.jpg';
                    document.getElementById('profile-1').src = '../image/profile_image.jpg';
                }
                retrival_post();
            }
        },
        error: function(xhr, status, error) {
            console.error('AJAX request failed:', status, error);
            console.log(xhr.responseText); // Log the full response for additional details
            alert('AJAX request failed. Please check the console for more information.');
        }
    });
}

$("#logout").on("click", function(e) { 
            e.preventDefault();
            console.log("Logging out");
            $.ajax({
                url: "../php_folder/login.php",
                type: "POST",
                dataType: "json",
                data: {
                    logout: true
                },
                success: function(data) {
                    if (data.status == 200) {
                        window.location.replace("../html_folder/login.html");
                        alertify.set('notifier', 'position', 'top-right');
                        alertify.success('Logout successful');
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    alertify.set('notifier', 'position', 'top-right');
                    alertify.error('Logout failed');
                     
                }
            });
        });


        



    </script>

</body>
</html>